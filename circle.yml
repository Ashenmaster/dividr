machine:
  node:
    version: v7.0.0
dependencies:
  pre:
    - npm install -g karma
    - npm install webpack -g
test:
  pre:
    - npm run report-coverage
  override:
    - karma start ./karma.conf.js --single-run --browsers PhantomJS --reporters karma-junit-reporter:
    - mocha tests/**/*.test.js --reporter mocha-junit-reporter:
        parallel: true
        files:
          - tests/meals.test.js
          - client/tests/**/*.test.js
        environment:
          MOCHA_FILE: $CIRCLE_TEST_REPORTS/junit/test-results.xml
          KARMA_FILE: $CIRCLE_TEST_REPORTS/karma/junit/test-results.xml
  post:
      - bash <(curl -s https://codecov.io/bash)
deployment:
  staging:
    branch: master
    heroku:
      appname: dividr-staging # appname must not include upper-case characters